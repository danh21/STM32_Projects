/*
 * USART.h
 *
 *  Created on: Apr 29, 2024
 *      Author: Danh21
 */

#ifndef USART_H_
#define USART_H_

#define f_PCLK 		16000000
#define baudrate 	115200



/* Initializing UART */
void USART_init()
{
	uint32_t USART_DIV, DIV_Mantissa, DIV_Fraction;

	RCC->APB1ENR |= RCC_APB1ENR_USART2EN; 				// USART2 clock enable

	USART2->CR1 |= USART_CR1_TE; 						// transmit enable
	USART2->CR1 |= USART_CR1_UE;						// USART enable

	USART_DIV = f_PCLK / (baudrate * 16);
	DIV_Mantissa = USART_DIV;
	DIV_Fraction = (USART_DIV - DIV_Mantissa) * 16;
	USART2->BRR |= (DIV_Mantissa<<4) | (DIV_Fraction);	// set baudrate
}



/* transmit data */
void USART_transmit(char *p)
{
	while (p)
	{
		USART2->DR = *p;										// load data
		while ((USART2->SR & USART_SR_TC_Msk ) != USART_SR_TC);	// wait until Transmission is complete
		p++;
	}
}

#endif /* USART_H_ */
